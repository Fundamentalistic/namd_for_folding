#!/bin/csh -f
goto begin
syntax:
  echo ''
  echo 'Usage: config [build_dir/]<arch> '
  echo ''
  echo 'arch: ' `( cd arch ; ls -1 |sed -e 's/Makearch\.//' | egrep -v 'template' )`
  echo ''
  exit 1

exists:
  echo ''
  echo 'directory already exists'
  echo ''
  exit 1

begin:

  if ($#argv < 1) goto syntax
  set ARCH=$1 ; shift
  set DIR=`pwd`;

  if ( x$ARCH == x ) goto syntax
  if ( ! -f arch/Makearch.$ARCH:t ) goto syntax
  if ( -d $ARCH ) goto exists

  echo "Creating Directory: $ARCH"
  mkdir $ARCH
  cd $ARCH

  set ROOTDIR=$DIR
  if ( $ARCH:t == $ARCH ) set ROOTDIR='..'

  echo "Creating link: Makearch.$ARCH:t to Makearch"
  ln -s $ROOTDIR/arch/Makearch.$ARCH:t ./Makearch
  echo "Linking Makefiles"
  ln -s $ROOTDIR/Makefile ./Makefile
  ln -s $ROOTDIR/Make.depends ./Make.depends
  ln -s $ROOTDIR/Make.charm ./Make.charm
  ln -s $ROOTDIR .rootdir
  echo "Creating src and linking files"
  (cd $DIR/src ; find . -name CVS -prune -o -type d -print )|sed -e s@.@@> temp.d
  (cd $DIR/src ; find . -name CVS -prune -o -type f -print )|sed -e s@.@@> temp.f
  awk '{print "mkdir src"$1;}' < temp.d > temp.m
  awk '{print "ln -s ../.rootdir src"$1;}' < temp.d >> temp.m
  awk '{print "ln -s .rootdir/src"$1" src"$1;}' < temp.f > temp.l
  sh temp.m
  sh temp.l
  rm -f temp.d temp.f temp.m temp.l
  echo "Creating dpme2 and linking files"
  (cd $DIR/dpme2;find . -name CVS -prune -o -type d -print )|sed -e s@.@@> temp.d
  (cd $DIR/dpme2;find . -name CVS -prune -o -type f -print )|sed -e s@.@@> temp.f
  awk '{print "mkdir dpme2"$1;}' < temp.d > temp.m
  awk '{print "ln -s ../.rootdir dpme2"$1;}' < temp.d >> temp.m
  awk '{print "ln -s .rootdir/dpme2"$1" dpme2"$1;}' < temp.f > temp.l
  sh temp.m
  sh temp.l
  rm -f temp.d temp.f temp.m temp.l
  echo "Creating dpmta-2.6 and linking files"
  (cd $DIR/dpmta-2.6;find . -name CVS -prune -o -type d -print )|sed -e s@.@@> temp.d
  (cd $DIR/dpmta-2.6;find . -name CVS -prune -o -type f -print )|sed -e s@.@@> temp.f
  awk '{print "mkdir dpmta-2.6"$1;}' < temp.d > temp.m
  awk '{print "ln -s ../.rootdir dpmta-2.6"$1;}' < temp.d >> temp.m
  awk '{print "ln -s .rootdir/dpmta-2.6"$1" dpmta-2.6"$1;}' < temp.f > temp.l
  sh temp.m
  sh temp.l
  rm -f temp.d temp.f temp.m temp.l
  echo "Creating pvm3 and linking files"
  (cd $DIR/pvm3 ; find . -name CVS -prune -o -type d -print )|sed -e s@.@@> temp.d
  (cd $DIR/pvm3 ; find . -name CVS -prune -o -type f -print )|sed -e s@.@@> temp.f
  awk '{print "mkdir pvm3"$1;}' < temp.d > temp.m
  awk '{print "ln -s ../.rootdir pvm3"$1;}' < temp.d >> temp.m
  awk '{print "ln -s .rootdir/pvm3"$1" pvm3"$1;}' < temp.f > temp.l
  sh temp.m
  sh temp.l
  rm -f temp.d temp.f temp.m temp.l
  echo "Creating efence and linking files"
  (cd $DIR/efence;find . -name CVS -prune -o -type d -print )|sed -e s@.@@> temp.d
  (cd $DIR/efence;find . -name CVS -prune -o -type f -print )|sed -e s@.@@> temp.f
  awk '{print "mkdir efence"$1;}' < temp.d > temp.m
  awk '{print "ln -s ../.rootdir efence"$1;}' < temp.d >> temp.m
  awk '{print "ln -s .rootdir/efence"$1" efence"$1;}' < temp.f > temp.l
  sh temp.m
  sh temp.l
  rm -f temp.d temp.f temp.m temp.l
  echo "You are ready to do a make in directory $ARCH now."
