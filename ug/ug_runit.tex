%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                          %
%              (C) Copyright 1995 The Board of Trustees of the             %
%                          University of Illinois                          %
%                           All Rights Reserved                            %
%								  	   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% RCS INFORMATION:
%
%       $RCSfile: ug_runit.tex,v $
%       $Author: jim $        $Locker:  $                $State: Exp $
%       $Revision: 1.4 $      $Date: 2000/09/29 20:41:15 $
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% DESCRIPTION:
%	This file contains the section of the NAMD User's Guide which
% describes how to actually run the program.
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% REVISION HISTORY:
%
% $Log: ug_runit.tex,v $
% Revision 1.4  2000/09/29 20:41:15  jim
% Updated many things for 2.2.
%
% Revision 1.3  1999/03/18 02:16:49  jim
% Spelling fixes.
%
% Revision 1.2  1998/03/09 23:42:15  milind
% Rewrote the entire section removing the PVM parts, and adding the converse
% details.
%
% Revision 1.1  1998/01/05 21:12:34  dhardy
% user guide, first draft
%
% Revision 1.8  1997/08/07 17:28:20  dhardy
% minor revisions
%
% Revision 1.7  1997/08/07 15:54:32  dhardy
% edit presentation style
%
% Revision 1.6  1997/06/23 18:29:39  nealk
% Updated setenv stuff.
%
% Revision 1.5  1997/04/24 15:10:11  nealk
% Added items for machine-specific environment settings (setenv).
%
% Revision 1.4  1996/05/15 19:21:07  jean
% ready (I hope) for 1.4 beta release
%
% Revision 1.3  1995/06/30 15:51:43  brunner
% More complete.  Now includes sections for everything except Exemplar
% and Charm++.  Still needs proofreading.
%
% Revision 1.2  1995/06/29  16:39:04  brunner
% Single node and PVM instructions complete.  The rest still need work.
%
% Revision 1.1  95/06/19  16:08:17  16:08:17  nelson (Mark T. Nelson)
% Initial revision
% 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Running \NAMD}
\label{section:run}

\NAMD\ runs on a variety of platforms.  Details of running on each
specific platform are given below.

\subsection{Workstation Networks}

Workstation networks require two files, the namd2 executable and the
conv-host program.  The conv-host program starts namd2 on the desired
hosts, and handles console I/O for the node programs.

To specify what machines namd2 will run on, the user creates a file
called "nodelist".  Below is an example nodelist file:

\begin{verbatim}
group main
 host brutus
 host romeo
\end{verbatim}

The "group main" line defines the default machine list.  Hosts brutus
and romeo are the two machines on which to run the simulation.  Note
that conv-host may run on one of those machines, or conv-host may run
on a third machine.

The "rsh" command ("remsh" on HPUX) is used to start namd2 on each node
specified in the nodelist file.  If NAMD fails without printing any
output, check to make sure that "rsh" works on your machine, by seeing
if "rsh hostname ls" works for each host in the nodelist.  If you want
or need to use "ssh" instead, then add "setenv CONV\_RSH ssh" to your
login or batch script and try "ssh hostname ls" to each host first to
ensure that the machine is in your .ssh/known\_hosts file.

Some automounters use a temporary mount directory which is prepended
to the path returned by the pwd command.  To run on multiple machines
you must place a "pathfix" line in your nodelist file before any
"host" lines.  For example:

\begin{verbatim}
group main
 pathfix /tmp_mnt
 host alpha1
 host alpha2
\end{verbatim}

A number of parameters may be passed to conv-host.  The most important
is the "+pX" option, where X specifies the number of processors.  If X
is less than the number of hosts in the nodelist, machines are
selected from top to bottom.  If X is greater than the number of
hosts, conv-host will start multiple processes on the machines,
starting from the top.  To run multiple processes on members of a SMP
workstation cluster, you may either just use the +p option to go
through the list the right number of times, or list each machine
several times, once for each processor.  The default is +p1.

You may specify the nodelist file with the "++nodelist" option and the
group (which defaults to "main") with the "++nodegroup" option.  If
you do not use "++nodelist" conv-host will first look for "nodelist"
in your current directory and then ".nodelist" in your home directory.

If you always want to run on the machine you are logged in to you may
use "localhost" in place of the hostname in your nodelist file, but
only if there are no other machines.  You will not need "pathfix".
For example, ".nodelist" in your home directory could read:

\begin{verbatim}
group main
 host localhost
\end{verbatim}

Once the nodelist file is set up, and you have your configuration file
prepared (alanin.conf, in this example), run NAMD as follows:

\begin{verbatim}
conv-host +pX namd2 alanin.conf
\end{verbatim}

Intel and Alpha processors produce binary files (restart and DCD
files) which must be "byte-swapped" to be read on other platforms.
The flipbinpdb and flipdcd programs will perform this conversion.
NAMD and VMD now handle this conversion automatically for most files.

\subsection{Windows Workstation Networks}

Windows is the same as other workstation networks described above,
except that rsh is not available on this platform.  Instead, you must
run the provided daemon (daemon.exe) on every node listed in the
nodelist file, even if you are only running on one machine.  Using
daemon\_background rather than daemon will eliminate consoles for the
daemon and node processes.

\subsection{IBM RS/6000 SP}

Run NAMD as you would any POE program.  The options and environment
variables for poe are various and arcane, so you should consult your
local documentation for recommended settings.  As an example, to run
interactively on Blue Horizon one would specify:

\begin{verbatim}
poe namd2 alanin.conf -nodes n -tasks_per_node m -rmpool 1
\end{verbatim}

\subsection{Cray T3E}

The T3E version has been tested on the Pittsburgh Supercomputer Center
T3E.  To run on X processors, use the mpprun command:

mpprun -n X namd2 alanin.conf

\subsection{Origin 2000}

For small numbers of processors (1-8) use the non-MPI version of namd2.
If your stack size limit is unlimited, which DQS may do, you will need
to set it with "limit stacksize 64M" to run on multiple processors.
To run on X processors call the binary directly with the +p option:

\begin{verbatim}
namd2 +pX alanin.conf
\end{verbatim}

For better performance on larger numbers of processors we recommend
that you use the MPI version of NAMD.  To run this version, you must
have MPI installed.  Furthermore, you must set two environment
variables to tell MPI how to allocate certain internal buffers.  Put
the following commands in your .cshrc or .profile file, or in your
job file if you are running under a queuing system:

\begin{verbatim}
setenv MPI_REQUEST_MAX 10240
setenv MPI_TYPE_MAX 10240
\end{verbatim}

Then run NAMD with the following command:

\begin{verbatim}
mpirun -np X namd2 alanin.conf
\end{verbatim}


